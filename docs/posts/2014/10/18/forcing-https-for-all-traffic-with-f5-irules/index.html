<!DOCTYPE html>
<html>
    <head>
        <title>Forcing HTTPS for all traffic with F5 iRules &mdash; jwage.com &mdash; I am Jonathan H. Wage</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

            <meta name="robots" content="index, follow">

        <link href="https://jwage.com/components/bootstrap/css/bootstrap.min.css?4" rel="stylesheet" type="text/css" />
        <link href="https://jwage.com/css/style.css?4" rel="stylesheet" type="text/css" />

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="stylesheet" href="https://jwage.com/components/highlightjs/styles/github.css?4" />
        <link rel="alternate" type="application/atom+xml" href="https://jwage.com/atom.xml" title="jwage.com activity feed" />

        
            </head>
    <body>

        <header>
            <!-- Fixed navbar -->
            <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
                <a class="navbar-brand" href="https://jwage.com"><img src="https://jwage.com/images/me.jpg" class="rounded-circle mr-3" />jwage.com</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="https://jwage.com">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://jwage.com/blog">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://jwage.com/articles">Articles</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://jwage.com/kubota-l210">Kubota L210</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://jwage.com/archive">Archive</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="container">
                <article>
        <header>
            <h2>Forcing HTTPS for all traffic with F5 iRules <small>post</small></h2>
        </header>

        <p class="lead">Posted on 2014-10-18 by jwage</p>

        <hr />

        <div>
            <p>If you want to force all traffic to HTTPS you can do so pretty easily by adding a F5 iRule to the HTTP VIP.</p>

<pre><code>when HTTP_REQUEST {
    HTTP::redirect "https://[HTTP::host][HTTP::uri]"
}
</code></pre>

<p>You should have two virtual servers configured in the F5, one for HTTP and one for HTTPS. By adding the redirect iRule to the HTTP virtual server it will only be executed for traffic that comes in without HTTPS. This means the iRule code above does not need any kind of conditional to check what the protocol is and only redirect when it is not HTTPS.</p>

<p>If you wanted to wrap some other conditional around the redirect, say you don&rsquo;t want to redirect one particular section of your site, you can do this:</p>

<pre><code>when HTTP_REQUEST {
    if { not ([string tolower [HTTP::path]] starts_with "/non-secure-section") } {
        HTTP::redirect "https://[HTTP::host][HTTP::uri]"
    }
}
</code></pre>

        </div>
                
                    <nav class="article">
                <ul>
                                            <li>Next: <a class="next" href="https://jwage.com/posts/2014/11/27/fixing-nginx-too-many-open-files-errors" title="Fixing nginx &quot;Too many open files&quot; errors"><span class="title">Fixing nginx &quot;Too many open files&quot; errors</span></a></li>
                                                                <li>Previous: <a class="previous" href="https://jwage.com/posts/2014/07/22/2014-vacation-books" title="2014 Vacation Books"><span class="title">2014 Vacation Books</span></a></li>
                                    </ul>
            </nav>
            </article>



        </main>

        <footer class="footer">
            <div class="container">
                <span class="text-muted"><img src="https://jwage.com/images/me.jpg" class="rounded-circle mr-3" style="width: 25px;" />&copy; 2018 jwage.com</span>
            </div>
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js?4"></script>
        <script>window.jQuery || document.write('<script src="https://jwage.com/components/jquery/jquery.min.js?4"><\/script>')</script>
        <script src="https://jwage.com/components/bootstrap/js/bootstrap.min.js?4"></script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-6', 'auto');
                ga('send', 'pageview');
            </script>
        
        <script src="https://jwage.com/components/highlightjs/highlight.pack.js?4"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        
            </body>
</html>

<!DOCTYPE html>
<html>
    <head>
        <title>Fixing nginx &quot;Too many open files&quot; errors &mdash; jwage.com &mdash; I am Jonathan H. Wage</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

            <meta name="robots" content="index, follow">

        <link href="https://jwage.com/components/bootstrap/css/bootstrap.min.css?2" rel="stylesheet" type="text/css" />
        <link href="https://jwage.com/css/style.css?2" rel="stylesheet" type="text/css" />

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="stylesheet" href="https://jwage.com/components/highlightjs/styles/github.css?2" />
        <link rel="alternate" type="application/atom+xml" href="https://jwage.com/atom.xml" title="jwage.com activity feed" />

        
            </head>
    <body>

        <header>
            <!-- Fixed navbar -->
            <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
                <a class="navbar-brand" href="https://jwage.com"><img src="https://jwage.com/images/me.jpg" class="rounded-circle mr-3" />jwage.com</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="https://jwage.com">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://jwage.com/blog">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://jwage.com/articles">Articles</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://jwage.com/kubota-l210">Kubota L210</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://jwage.com/archive">Archive</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="container">
                <article>
        <header>
            <h2>Fixing nginx &quot;Too many open files&quot; errors <small>post</small></h2>
        </header>
        <div>
            <p>At <a href="https://www.opensky.com" target="_blank">OpenSky</a>, we recently migrated to the <a href="http://instartlogic.com/" target="_blank">InstartLogic CDN</a>. One of the features they provide is the ability to resize images by appending <code>?iresize=width:500,height:500</code> to your image URLs.</p>

<p>This feature allowed us to start serving static files directly through nginx instead of going through our application to generate the requested size. Now, InstartLogic does all the resizing work for us and our backend PHP servers are relieved of this responsibility.</p>

<p>This was a nice win for us but it introduced a slight new problem. Nginx started complaining about &ldquo;Too many open files&rdquo;. This was easily fixed for us by setting the <code>worker_rlimit_nofile</code> setting in the <code>nginx.conf</code> file to 30000.</p>

<pre><code>worker_rlimit_nofile 30000;
</code></pre>

<p>After this change our backend PHP servers have a lighter load and the first request for an image through the CDN is much faster.</p>

        </div>
                
                    <nav class="article">
                <ul>
                                            <li>Next: <a class="next" href="https://jwage.com/posts/2014/11/27/when-to-inject-the-container" title="When to Inject the Container"><span class="title">When to Inject the Container</span></a></li>
                                                                <li>Previous: <a class="previous" href="https://jwage.com/posts/2014/10/18/forcing-https-for-all-traffic-with-f5-irules" title="Forcing HTTPS for all traffic with F5 iRules"><span class="title">Forcing HTTPS for all traffic with F5 iRules</span></a></li>
                                    </ul>
            </nav>
            </article>



        </main>

        <footer class="footer">
            <div class="container">
                <span class="text-muted">&copy; 2018 jwage.com</span>
            </div>
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js?2"></script>
        <script>window.jQuery || document.write('<script src="https://jwage.com/components/jquery/jquery.min.js?2"><\/script>')</script>
        <script src="https://jwage.com/components/bootstrap/js/bootstrap.min.js?2"></script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-6', 'auto');
                ga('send', 'pageview');
            </script>
        
        <script src="https://jwage.com/components/highlightjs/highlight.pack.js?2"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        
            </body>
</html>

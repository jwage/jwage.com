<!DOCTYPE html>
<html>
    <head>
        <title>Fixing nginx &quot;Too many open files&quot; errors &mdash; jwage.com &mdash; I am Jonathan H. Wage</title>
        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta name="robots" content="index, follow">
        <link href="https://jwage.com/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="https://jwage.com/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="stylesheet" href="https://jwage.com/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="https://jwage.com/atom.xml" title="jwage.com activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
                                    </head>
    <body>
        <header>
            <nav class="navbar navbar-inverse navbar-fixed-top">
                <div class="container">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="https://jwage.com/">jwage.com</a>
                    </div>
                    <div id="navbar" class="collapse navbar-collapse">
                        <ul class="nav navbar-nav">
                            <li><a href="https://jwage.com/about">About</a></li>
                            <li><a href="https://jwage.com/blog">Blog</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2>Fixing nginx &quot;Too many open files&quot; errors <small>post</small></h2>
        </header>
        <div>
            <p>At <a href="https://www.opensky.com" target="_blank">OpenSky</a>, we recently migrated to the <a href="http://instartlogic.com/" target="_blank">InstartLogic CDN</a>. One of the features they provide is the ability to resize images by appending <code>?iresize=width:500,height:500</code> to your image URLs.</p>

<p>This feature allowed us to start serving static files directly through nginx instead of going through our application to generate the requested size. Now, InstartLogic does all the resizing work for us and our backend PHP servers are relieved of this responsibility.</p>

<p>This was a nice win for us but it introduced a slight new problem. Nginx started complaining about &ldquo;Too many open files&rdquo;. This was easily fixed for us by setting the <code>worker_rlimit_nofile</code> setting in the <code>nginx.conf</code> file to 30000.</p>

<pre><code>worker_rlimit_nofile 30000;
</code></pre>

<p>After this change our backend PHP servers have a lighter load and the first request for an image through the CDN is much faster.</p>

        </div>
                
                    <nav class="article">
                <ul>
                                            <li>Next: <a class="next" href="https://jwage.com/post/2014/11/27/when-to-inject-the-container" title="When to Inject the Container"><span class="title">When to Inject the Container</span></a></li>
                                                                <li>Previous: <a class="previous" href="https://jwage.com/post/2014/10/18/forcing-https-for-all-traffic-with-f5-irules" title="Forcing HTTPS for all traffic with F5 iRules"><span class="title">Forcing HTTPS for all traffic with F5 iRules</span></a></li>
                                    </ul>
            </nav>
            </article>



                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2018 jwage.com
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="https://jwage.com/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="https://jwage.com/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="https://jwage.com/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

                    </body>
</html>
